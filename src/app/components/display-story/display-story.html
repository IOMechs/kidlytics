@if(isLoading()) {
<section class="text-center py-4">
  <span class="loading loading-spinner loading-xl text-primary"></span>
</section>
} @else {
<div
  class="flex flex-col items-center px-4 py-3 w-full min-h-screen bg-base-100"
>
  <div>
    <div class="flex flex-col items-center justify-baseline gap-4 w-full mb-4">
      <div class="flex items-center gap-4">
        <h1 class="font-bold text-2xl md:text-3xl text-center">
          {{ storyTitle() }}
        </h1>

        <div class="flex items-center gap-2">
          <div
            class="badge badge-secondary sm:text-xs sm:w-auto w-14"
            matTooltip="Appropriate for Age {{ ageGroup() }}"
            matTooltipPosition="above"
          >
            {{ ageGroup() }}
          </div>

          <button
            mat-icon-button
            class="btn btn-circle btn-ghost btn-sm flex! items-center"
            matTooltip="View story details"
            matTooltipPosition="above"
            (click)="openDialog()"
          >
            <mat-icon class="text-secondary!">info</mat-icon>
          </button>
          <button
            mat-icon-button
            class="btn btn-circle btn-ghost btn-sm flex! items-center"
            matTooltip="Print story"
            matTooltipPosition="above"
            (click)="print()"
            [disabled]="isPrinting()"
          >
            <mat-icon class="text-secondary!">print</mat-icon>
          </button>
        </div>
      </div>
    </div>
    @if(isPrinting()){
    <p class="text-center pb-2">Preparing your PDF...</p>
    } @defer{

    <app-story-card
      [isLoading]="isLoading()"
      [currentImage]="preloadedImages()[currentIndex()]?.src || ''"
      [currentStoryPart]="storyParts()[currentIndex()]"
      [storyLength]="storyParts().length"
      [currentIndex]="currentIndex()"
      (changeIndex)="modifyIndex($event)"
      (toggleSpeaking)="handleSpeech($event)"
      [audioPart]="storyAudio()[currentIndex()]"
      [shouldSpeak]="speakingSignal()"
      [language]="storyLanguage()"
    ></app-story-card>
    <app-social-share
      [shareUrl]="getShareUrl()"
      [imageUrl]="preloadedImages()[0]?.src || '' "
      [title]="storyTitle()"
    ></app-social-share>

    <!-- Only display button if feedback is not submitted -->
    @if(!checkFeedbackSubmitted()){
    <div class="flex justify-center gap-4">
      <button
        class="btn btn-primary my-4"
        [disabled]="!isLoggedIn()"
        (click)="onSaveStory()"
        [matTooltipDisabled]="isLoggedIn()"
        matTooltip="Please Log In to save the story"
        matTooltipPosition="above"
      >
        <mat-icon class="mx-auto block"> save</mat-icon>
        Save Story
      </button>
      <button class="btn btn-primary my-4" (click)="openTestimonialDialog()">
        Give Your Feedback
      </button>
    </div>
    } }
  </div>

  <div id="pdf-html-container" style="display: none"></div>
</div>
}
